<!DOCTYPE html><html lang="en"><head><meta name="description" content="Connect Sensitivity: Mute All Offline const firebaseConfig = { apiKey: AIzaSyCggTRDtB_AvupExwc0r7YKrzV2Pb1fS7w, authDomain: voicemap-p2p-c0768.firebas..."><meta name="twitter:description" content="Connect Sensitivity: Mute All Offline const firebaseConfig = { apiKey: AIzaSyCggTRDtB_AvupExwc0r7YKrzV2Pb1fS7w, authDomain: voicemap-p2p-c0768.firebas..."><meta property="og:title" content="VoiceMap P2P"><meta property="og:site_name" content="Pablo"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/@hodgef/slate-theme@3.0.34/build/page.css" rel="stylesheet"></head><body><script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script><div id="root" class="is-ssr theme-slate"><div class="page page-post"><header class="page-header"><div class="header-nav"><div class="container"><nav class="row navbar navbar-expand-lg navbar-dark"><a class="navbar-brand logo" href="https://nioz-zz.github.io/pablo/">Pablo</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent"><ul class="page-menu navbar-nav"><li class="nav-item"><a class="nav-link" href="https://nioz-zz.github.io/pablo/web-sensor-app/">Web Sensor App</a><div class="dropdown-menu"></div></li><li class="nav-item active"><a class="nav-link" href="https://nioz-zz.github.io/pablo/voicemap-p2p/">VoiceMap P2P</a><div class="dropdown-menu"></div></li></ul></div></nav></div></div></header><main><div class="container main-container"><h2>VoiceMap P2P</h2><div class="row"><div class="col"><div class="content"><section class="post-content mb-3 pb-5"><div class="post-inner-content"><!DOCTYPE html><html><head><meta charset="utf-8"><title>VoiceMap P2P Live</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><style>body{font-family:sans-serif;margin:0;padding:0}#map{height:60vh;width:100%}button,input{padding:10px;margin:10px;font-size:16px}.controls{display:flex;flex-wrap:wrap;align-items:center}.controls>*{margin:5px}</style><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"></head><body><h1>VoiceMap P2P Live</h1><div class="controls"><input id="roomInput" placeholder="Room"> <button id="connectBtn">Connect</button> <label>Sensitivity: <input id="micSens" type="range" min="0" max="100" value="50"></label> <button id="muteBtn">Mute All</button></div><p id="status">Offline</p><div id="map"></div><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><script>const firebaseConfig={apiKey:"AIzaSyCggTRDtB_AvupExwc0r7YKrzV2Pb1fS7w",authDomain:"voicemap-p2p-c0768.firebaseapp.com",databaseURL:"https://voicemap-p2p-c0768-default-rtdb.europe-west1.firebasedatabase.app",projectId:"voicemap-p2p-c0768",storageBucket:"voicemap-p2p-c0768.appspot.com",messagingSenderId:"587197832907",appId:"1:587197832907:web:5e8f2e0da8e488d4d2454e"};firebase.initializeApp(firebaseConfig);const db=firebase.database(),userId="user-"+Math.floor(1e4*Math.random());let localStream,pc,micTrack;const status=document.getElementById("status"),map=L.map("map").setView([37.9838,23.7275],13);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);const markers={};function addMarker(e,t,a){if(markers[e])markers[e].setLatLng([t,a]);else{const n=L.icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/25/25694.png",iconSize:[24,24]});markers[e]=L.marker([t,a],{icon:n}).addTo(map).bindPopup(e)}}async function start(e){status.textContent="Connecting...";try{await navigator.mediaDevices.getUserMedia({audio:!0}),await navigator.geolocation.getCurrentPosition(()=>{},()=>{})}catch{}localStream=await navigator.mediaDevices.getUserMedia({audio:!0}),micTrack=localStream.getAudioTracks()[0],pc=new RTCPeerConnection,localStream.getTracks().forEach(e=>pc.addTrack(e,localStream)),pc.onicecandidate=t=>{t.candidate&&db.ref(`rooms/${e}/candidates/${userId}`).push(t.candidate.toJSON())},pc.ontrack=e=>{const t=new Audio;t.srcObject=e.streams[0],t.play()};const t=db.ref("rooms/"+e);t.child("online/"+userId).set(!0),t.child("online/"+userId).onDisconnect().remove(),t.child("online").on("value",e=>{const t=e.val()||{};status.textContent=`Online (${Object.keys(t).length} users)`});if(!(await t.child("offers").once("value")).exists()){const e=await pc.createOffer();await pc.setLocalDescription(e),t.child("offers/"+userId).set(e.toJSON())}t.child("offers").on("child_added",async e=>{if(e.key===userId)return;const a=e.val();await pc.setRemoteDescription(new RTCSessionDescription(a));const n=await pc.createAnswer();await pc.setLocalDescription(n),t.child("answers/"+userId).set(n.toJSON())}),t.child("answers").on("child_added",async e=>{if(e.key===userId)return;const t=e.val();await pc.setRemoteDescription(new RTCSessionDescription(t))}),t.child("candidates").on("child_added",e=>{e.child(userId).forEach(e=>{const t=e.val();pc.addIceCandidate(new RTCIceCandidate(t))})}),navigator.geolocation.watchPosition(t=>{const{latitude:a,longitude:n}=t.coords;db.ref(`rooms/${e}/positions/${userId}`).set({lat:a,lon:n})}),t.child("positions").on("child_added",e=>{const t=e.key,{lat:a,lon:n}=e.val();addMarker(t,a,n)}),t.child("positions").on("child_changed",e=>{const t=e.key,{lat:a,lon:n}=e.val();addMarker(t,a,n)}),document.getElementById("micSens").oninput=e=>{const t=parseInt(e.target.value);micTrack&&micTrack.applyConstraints({volume:t/100})},document.getElementById("muteBtn").onclick=()=>{micTrack&&(micTrack.enabled=!micTrack.enabled)},status.textContent="Connected to room: "+e}document.getElementById("connectBtn").onclick=()=>{start(document.getElementById("roomInput").value||"default")};</script></body></html></div></section></div></div></div></div></main><footer class="page-footer"><div class="container"><div class="row"><div class="col col-12 col-md-6"><span>Â©<!-- --> Pablo</span></div><div class="col col-12 col-md-6 mt-3 mt-md-0 d-flex justify-content-md-end"><a href="https://prss.io" class="d-flex align-items-center footer-shoutout" target="_blank" rel="noopener" title="Powered by PRSS Site Creator"><img class="prss-footer-image mr-1" src="https://prss-static.volted.co/images/logo.png" width="16"><span class="font-weight-bold prss-tag">PRSS Site Creator</span></a></div></div></div></footer></div></div></body></html>